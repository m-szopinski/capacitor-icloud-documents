{"version":3,"file":"web.js","sourceRoot":"","sources":["../../src/web.ts"],"names":[],"mappings":"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","sourcesContent":["import { WebPlugin } from '@capacitor/core';\n\nimport type { ICloudDocsPlugin } from './definitions';\n\nimport * as fs from '@browserfs/core/emulation/callbacks';\nimport * as bfs from '@browserfs/core/index';\n\nimport { StorageFileSystem } from '@browserfs/dom/backends/Storage';\n\n// import {\n//   initialize,\n\n// } from '@browserfs/core/emulation/shared'\n\nexport class ICloudDocsWeb extends WebPlugin implements ICloudDocsPlugin {\n  async echo(options: { value: string }): Promise<{ value: string }> {\n    console.log('ECHO', options);\n    return options;\n  }\n  async readFile(options: {\n    filePath: string;\n  }): Promise<{ fileStream: string }> {\n    console.log('Read iCloud file', options);\n    return new Promise((resolve, reject) => {\n      fs.readFile(`/fs/${options.filePath}`, 'utf-8', (err, content: any) => {\n        if (err) {\n          reject(err);\n        }\n        resolve({\n          fileStream: content,\n        });\n      });\n    });\n  }\n  async readFileB64(options: {\n    filePath: string;\n  }): Promise<{ fileStream: string }> {\n    console.log('Read Base64 iCloud file', options);\n    return new Promise((resolve, reject) => {\n      fs.readFile(`/fs/${options.filePath}`, (err, content) => {\n        if (err) {\n          reject(err);\n        }\n        resolve({\n          fileStream: content?.toString() || '',\n        });\n      });\n    });\n  }\n  async removeFile(options: {\n    filePath: string;\n  }): Promise<{ result: string; url: string }> {\n    console.log('Remove iCloud file', options);\n    return new Promise((resolve, reject) => {\n      fs.unlink(`/fs/${options.filePath}`, err => {\n        if (err) {\n          reject(err);\n        }\n        resolve({\n          result: 'OK',\n          url: options.filePath,\n        });\n      });\n    });\n  }\n  async writeFile(options: {\n    filePath: string;\n    data: string;\n  }): Promise<{ result: string; url: string }> {\n    console.log('Write iCloud file', options);\n    return new Promise((resolve, reject) => {\n      fs.writeFile(`/fs/${options.filePath}`, options.data, err => {\n        if (err) {\n          reject(err);\n        }\n        resolve({\n          result: 'OK',\n          url: options.filePath,\n        });\n      });\n    });\n  }\n  async fileExist(options: { path: string }): Promise<{ result: boolean }> {\n    console.log('Check if iCloud file exist', options);\n    return new Promise(resolve => {\n      fs.exists(`/fs/${options.path}`, exist => {\n        resolve({\n          result: exist,\n        });\n      });\n    });\n  }\n  async mkdir(options: {\n    path: string;\n  }): Promise<{ result: string; url: string }> {\n    console.log('Create iCloud directory', options);\n    return new Promise((resolve, reject) => {\n      fs.mkdir(`/fs/${options.path}`, undefined, err => {\n        if (err) {\n          reject(err);\n        }\n        resolve({\n          result: 'OK',\n          url: options.path,\n        });\n      });\n    });\n  }\n  async stat(options: { path: string }): Promise<{\n    type: 'Directory' | 'File';\n    size: number;\n    modificationDate: string;\n    creationDate: string;\n  }> {\n    console.log('Stat of iCloud file', options);\n    return new Promise((resolve, reject) => {\n      fs.stat(`/fs/${options.path}`, (err, result) => {\n        if (err) {\n          reject(err);\n        }\n        resolve({\n          type: result!.isDirectory() ? 'Directory' : 'File',\n          size: result!.size,\n          modificationDate: result?.mtime.toString() || new Date().toString(),\n          creationDate: result?.ctime.toString() || new Date().toString(),\n        });\n      });\n    });\n  }\n  async readdir(options: { path: string }): Promise<{ result: string[] }> {\n    console.log('List iCloud files', options);\n    return new Promise((resolve, reject) => {\n      fs.readdir(`/fs/${options.path}`, (err, result) => {\n        if (err) {\n          reject(err);\n        }\n        resolve({\n          result: result || [],\n        });\n      });\n    });\n  }\n  async initUbiquitousContainer(): Promise<void> {\n    console.log('Init iCloud container');\n    bfs.registerBackend(StorageFileSystem as any);\n    return new Promise((resolve, reject) => {\n      bfs\n        .configure({\n          '/': { fs: 'Storage', options: { storage: localStorage } },\n        })\n        .then(() => {\n          fs.exists('/fs', exists => {\n            if (!exists) {\n              fs.mkdir('/fs', () => {\n                resolve();\n              });\n            } else {\n              resolve();\n            }\n          });\n        }).catch((err) => {\n          reject(err);\n        });\n    });\n  }\n  async syncToCloud(options: {\n    filePath: string;\n    destinationFolder: string;\n  }): Promise<{ url: string }> {\n    console.log('Sync iCloud file', options);\n    return { url: '' };\n  }\n}\n"]}